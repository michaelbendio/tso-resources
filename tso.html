<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TSO Resources</title>

<style>
body { font-family: -apple-system, sans-serif; margin:0; padding:0; }
.topbar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 24px;
  background:#003366;
  color:white;
}

.topbar .title {
  font-size:20px;
  font-weight:600;
}

.topbar .tabs {
  display:flex;
  gap:24px;
}

.topbar .tabs span {
  cursor:pointer;
  opacity:.9;
}

.topbar .tabs span:hover {
  opacity:1;
}

.hidden { display:none; }
.grid { display:grid; gap:12px; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); }
.category-card, .resource-card { border:1px solid #ddd; padding:12px; border-radius:6px; background:white; }
.resource-card { position:relative; }
.star { position:absolute; left:8px; top:8px; cursor:pointer; font-size:18px; }
.star.fav { color:gold; }
.resource-main { margin-left:24px; }
.resource-details.collapsed { display:none; }
.button { padding:6px 10px; margin:4px 0; cursor:pointer; }
.button.primary { background:#003366; color:white; }
.button.danger { background:#aa0000; color:white; }
textarea.big { width:100%; min-height:80px; }
.admin-panel { display:flex; gap:20px; }
.admin-box { flex:1; border:1px solid #ddd; padding:12px; }
.category-grid { display:grid; gap:6px; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); }

/* Print modal */
#printModal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:flex;
  justify-content:center;
  align-items:center;
}
#printModal.hidden { display:none; }
#printContentWrapper {
  background:white;
  padding:20px;
  max-height:90%;
  overflow:auto;
  width:800px;
}
@media print {
  body * {
    visibility: hidden;
  }

  #printContentWrapper,
  #printContentWrapper * {
    visibility: visible;
  }

  #printContentWrapper {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
  }

  /* Hide modal buttons when printing */
  #printContentWrapper button {
    display: none !important;
  }
}
</style>
</head>

<body>

<div class="topbar">
  <div class="title">TSO Resources</div>
  <div class="tabs">
    <span id="tabCategories">Categories</span>
    <span id="tabFavorites">Favorites (0)</span>
    <span id="tabAdmin">Admin</span>
  </div>
</div>

<div id="appView"></div>
<div id="adminView" class="hidden"></div>

<div id="printModal" class="hidden">
  <div id="printContentWrapper">
    <button class="button" onclick="closePrintPreview()">Close</button>
    <button class="button primary" onclick="doPrint()">Print</button>
    <div id="printContent"></div>
  </div>
</div>

<!-- ===== PASTE YOUR SEED DATA BLOCK HERE ===== -->
<script id="seed-data" type="application/json">
{
  "version": 6,
  "lastModified": "2026-02-23T23:42:06.253Z",
  "categories": [
    {
      "id": "clothing",
      "label": "Clothing",
      "icon": "shirt",
      "active": true,
      "lastModified": "2026-02-17T21:38:50.616Z",
      "displayOrder": 10
    },
    {
      "id": "employment",
      "label": "Employment",
      "icon": "briefcase",
      "active": true,
      "lastModified": "",
      "displayOrder": 20
    },
    {
      "id": "food",
      "label": "Food Assistance",
      "icon": "utensils",
      "active": true,
      "lastModified": "",
      "displayOrder": 30
    },
    {
      "id": "health",
      "label": "Health Care",
      "icon": "med",
      "active": true,
      "lastModified": "2026-02-17T21:39:51.252Z",
      "displayOrder": 40
    },
    {
      "id": "housing",
      "label": "Housing",
      "icon": "home",
      "active": true,
      "lastModified": "",
      "displayOrder": 50
    },
    {
      "id": "id",
      "label": "ID",
      "icon": "person",
      "active": true,
      "lastModified": "2026-02-23T23:13:18.416Z",
      "displayOrder": 60
    },
    {
      "id": "mental",
      "label": "Mental Health",
      "icon": "head",
      "active": true,
      "lastModified": "2026-02-17T21:39:10.268Z",
      "displayOrder": 70
    },
    {
      "id": "substance",
      "label": "Substance Abuse",
      "icon": "pill",
      "active": true,
      "lastModified": "2026-02-17T21:40:07.314Z",
      "displayOrder": 80
    },
    {
      "id": "transportation",
      "label": "Transportation",
      "icon": "bus",
      "active": true,
      "lastModified": "",
      "displayOrder": 90
    },
    {
      "id": "Seniors",
      "label": "Seniors",
      "icon": "",
      "active": true,
      "lastModified": "2026-02-19T18:09:30.392Z",
      "displayOrder": 100
    }
  ],
  "resources": [
    {
      "id": "casfb",
      "name": "Community Action Services And Food Bank - Provo",
      "categories": [
        "food",
        "housing",
        "id"
      ],
      "phone": "801-373-8200",
      "address": "815 S Freedom Blvd, Provo, UT",
      "website": "https://www.communityactionprovo.org",
      "hours": "",
      "description": "A non-profit organization that provides emergency assistance and long-term support to help families in poverty become self-reliant through programs and counseling.",
      "services": [
        "Help getting an ID; verify homelessness (waives ID fee and residency requiremnts), then apply in person at Drivers License Division office)",
        "Food pantry",
        "Rent & rent deposit payment assistance (as available)",
        "Utility service payment assistance (as available)",
        "Personal finance counseling",
        "Driver license fee payment (as available)",
        "Clothing vouchers (as available)",
        "Bus fare (as available)"
      ],
      "verifiedDate": "",
      "lastModified": "2026-02-23T23:42:06.253Z",
      "verifiedBy": "",
      "displayOrder": null
    },
    {
      "id": "deseret-industries-provo",
      "name": "Deseret Industries (Provo)",
      "categories": [
        "clothing",
        "employment"
      ],
      "website": "https://www.deseretindustries.org/locations/provo-ut",
      "phone": "801-373-7920",
      "address": "1415 N State St, Provo, UT 84604",
      "description": "Thrift store and job training opportunities.",
      "services": [
        "Nonprofit thrift store",
        "Training and job readiness",
        "Further education",
        "Remove employment barriers",
        "Explore career options",
        "Support during job search"
      ],
      "favorite": false,
      "lastModified": "2026-02-23T20:22:14.647Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "dws-vocational-rehabilitation-provo-office",
      "name": "DWS Vocational Rehabilitation - Provo Office",
      "categories": [
        "employment"
      ],
      "website": "https://jobs.utah.gov/",
      "phone": "801-806-0955",
      "address": "150 E Center St Suite 3300, Provo, UT 84606",
      "description": "Vocational rehabilitation services (disability employment support).",
      "services": [
        "Employment--help with resume, workshops, paying for education or training, apprenticeships",
        "Veteran and Military employment services--education, training, career path, transition",
        "Refugee resettlement, employment, resources",
        "Disabled services, blind, deaf, eligility, vocational rehabilititation"
      ],
      "favorite": false,
      "lastModified": "2026-02-23T20:29:27.437Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "easterseals-goodwill-senior-employment-program-scsep",
      "name": "Easterseals-Goodwill Senior Employment Program (SCSEP)",
      "categories": [
        "employment",
        "mental"
      ],
      "website": "http://www.esgw.org/scsep/",
      "phone": "1-800-771-2153",
      "address": "Utah (serves multiple counties; see website)",
      "description": "Paid on-the-job training for qualifying older adults.",
      "services": [
        "Early intervention for disabled children under three",
        "On-the-job employment services for low-income adults over 55."
      ],
      "favorite": false,
      "lastModified": "2026-02-23T20:33:58.569Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "family-promise-salt-lake",
      "name": "Family Promise Salt Lake",
      "categories": [
        "housing"
      ],
      "website": "https://familypromisesaltlake.org/",
      "phone": "801-961-8622",
      "address": "814 W 800 S, Salt Lake City, UT 84104",
      "description": "Emergency shelter and support for families with children experiencing homelessness.",
      "services": [
        "Provide safe family emergency shelter and basic needs for families with children."
      ],
      "favorite": false,
      "lastModified": "2026-02-23T20:36:00.409Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "facc",
      "name": "Food and Care Coalition",
      "categories": [
        "clothing",
        "food",
        "health",
        "housing",
        "id",
        "mental",
        "Seniors"
      ],
      "phone": "801-373-1825",
      "address": "299 E 900 S, Provo, UT 84606",
      "website": "https://foodandcare.org",
      "hours": "M–Sa 8:30am – 5:30pm",
      "description": "Provides services for individuals who are homeless, including prepared hot meals, bathing facilities, haircuts, laundry, dental, case management, emergency shelter, and transitional housing. Also has onsite partners providing mental health and medical services.",
      "services": [
        "Help getting an ID; verify homelessness (waives ID fee and residency requiremnts), then apply in person at Drivers License Division office)",
        "prepared hot meals",
        "public showers/baths",
        "laundry facilities",
        "haircuts / grooming supplies",
        "dental services (as available)",
        "case management",
        "emergency shelter",
        "transitional housing",
        "temporary mailing address (as available)"
      ],
      "verifiedDate": "",
      "lastModified": "2026-02-23T22:43:07.146Z",
      "verifiedBy": "",
      "displayOrder": null
    },
    {
      "id": "housing-authority-of-utah-county",
      "name": "Housing Authority of Utah County",
      "categories": [
        "housing"
      ],
      "website": "https://housinguc.org/",
      "phone": "801-373-8333",
      "address": "485 N Freedom Blvd, Provo, UT 84601",
      "description": "Affordable housing programs",
      "services": [
        "Portal for waiting lists for housing for 55+, 62+, family housing, Spring Lake Apartments and Willow Cove."
      ],
      "favorite": false,
      "lastModified": "2026-02-23T20:42:19.294Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "mountainlands-community-health-center-provo-family-health-ce",
      "name": "Mountainlands Community Health Center (Provo Family Health Center)",
      "categories": [
        "health"
      ],
      "website": "https://www.mountainlands.org/provo",
      "phone": "801-429-2000",
      "address": "589 S State St, Provo, UT 84606",
      "description": "Sliding-fee primary care clinic and related services.",
      "services": [
        "Provide low-income, uninsured and under-insured persons with high-quality health care.",
        "Medical",
        "Mental Health",
        "Dental",
        "Pharmacy"
      ],
      "favorite": false,
      "lastModified": "2026-02-23T20:44:58.073Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "odyssey-house-of-utah",
      "name": "Odyssey House of Utah",
      "categories": [
        "mental",
        "substance"
      ],
      "website": "https://www.odysseyhouse.org/",
      "phone": "",
      "address": "Salt Lake City, UT (multiple programs)",
      "description": "Substance use disorder and mental health treatment programs.",
      "services": [
        "Largest and most comprehensive addiction program in Utah. Free for low-income Salt Lake residents."
      ],
      "favorite": false,
      "lastModified": "2026-02-23T20:51:34.667Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "provo-city-housing-authority",
      "name": "Provo City Housing Authority",
      "categories": [
        "housing"
      ],
      "website": "https://provohousing.org/",
      "phone": "801-900-5676",
      "address": "688 W 100 N, Provo, UT 84601",
      "description": "Public housing and housing assistance for Provo residents.",
      "services": [
        "Help with Dept. of Housing and Urban Development programs: Public Housing and Housing Choice Voucher program for the city of Provo",
        "Supportive Housing",
        "LIHTC (Low-Income Housing Tax Credit) housing",
        "Senior housing (six Provo locations)",
        "Family Self Sufficiency program"
      ],
      "favorite": false,
      "lastModified": "2026-02-23T21:00:39.291Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "proxima-careers",
      "name": "Proxima Careers",
      "categories": [
        "employment",
        "health"
      ],
      "website": "https://proximacareers.org/",
      "phone": "",
      "address": "Utah (program-based; see website)",
      "description": "Supports pathways into healthcare certification/degree programs and job readiness.",
      "services": [
        "Career assessment",
        "Certification/degree from a school of your choice. They cover the majority or full costs."
      ],
      "favorite": false,
      "lastModified": "2026-02-23T21:07:08.523Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "Catholic Community Services",
      "name": "St. Vincent de Paul Dining Hall & Bishop Weigand Resource Center (CCS Utah)",
      "categories": [
        "clothing",
        "employment",
        "food",
        "housing"
      ],
      "website": "https://www.ccsutah.org/programs/st-vincent-de-paul-dining-hall",
      "phone": "801-363-7710",
      "address": "437 W 200 S, Salt Lake City, UT 84101",
      "description": "Meals and basic needs services (Salt Lake City).",
      "services": [
        "Bishop Weigand Resource Center (shelter)",
        "St. Vincent de Paul Dining Hall",
        "St. Vincent's Kitchen Academy (fourteen week culinary arts training)",
        "Refugee services: foster care for unaccompanied minors, resettlement"
      ],
      "favorite": false,
      "lastModified": "2026-02-23T21:15:58.991Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "tabitha",
      "name": "Tabitha's Way",
      "categories": [
        "clothing",
        "food"
      ],
      "phone": "Pleasant Grove: 801-692-1881, Spanish Fork: 801-709-8573, Saratoga Springs: 801-692-1881, ext 301",
      "address": "675 W Garden Dr #100, Pleasant Grove; 50 E 100. North, Spanish Fork, 1439 N Commerce Dr, Saratoga Springs",
      "website": "tabithasway.org",
      "hours": "",
      "description": "A non-profit organization that provides a food pantry and hygiene items to those in need in the community.",
      "services": [
        "Requirements: picture ID, proof of address (for example a piece of mail)",
        "Food pantry--two week supply of food twice a month",
        "Hygiene items",
        "Diapers (as available)",
        "Baby food (as available)",
        "Thanksgiving baskets (seasonal)"
      ],
      "verifiedDate": "",
      "lastModified": "2026-02-23T21:23:26.638Z",
      "verifiedBy": "",
      "displayOrder": null
    },
    {
      "id": "the-road-home",
      "name": "The Road Home",
      "categories": [
        "housing"
      ],
      "website": "https://theroadhome.org/",
      "phone": "801-456-5900",
      "address": "242 Paramount Ave, Salt Lake City, UT 84115 (Gail Miller Resource Center)",
      "description": "Shelter and housing services (Salt Lake County); statewide referral relevance.",
      "services": [
        "Homeless services line: 801-990-9999",
        "FINCH housing--family emergency shelter with private furnished rooms for families with children",
        "Pamela Atkinson Resource Center (shelter)",
        "Gail Miller Resource Center (shelter)",
        "Connie Crosby Family Resource Center"
      ],
      "favorite": false,
      "lastModified": "2026-02-23T21:29:01.318Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "united-way-of-utah-county",
      "name": "United Way of Utah County",
      "categories": [
        "clothing",
        "employment",
        "food",
        "health",
        "housing",
        "mental",
        "substance",
        "transportation",
        "Seniors"
      ],
      "website": "app.utah211.org (choose Southern Utah)",
      "phone": "801-471-0601",
      "address": "Utah County",
      "description": "A wide range of listings of resources",
      "services": [
        "directory of a wide range of resources in Utah County."
      ],
      "favorite": false,
      "lastModified": "2026-02-23T22:08:33.471Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "uta-paratransit",
      "name": "UTA Paratransit",
      "categories": [
        "transportation"
      ],
      "website": "https://www.rideuta.com/Rider-Info/Contact-Us",
      "phone": "801-287-7433",
      "address": "Utah (paratransit)",
      "description": "Paratransit scheduling and information line.",
      "services": [
        "Transportation for people with physical, cognitive or visual disabilities who are functionally unable to independently use the UTA fixed route bus service."
      ],
      "favorite": false,
      "lastModified": "2026-02-23T21:56:22.246Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "uta-reduced-fare-farepay-card",
      "name": "UTA Reduced Fare FAREPAY Card",
      "categories": [
        "transportation"
      ],
      "website": "https://www.rideuta.com/Fares-And-Passes/Individual-Fares/Reduced-Fare",
      "phone": "801-743-3882",
      "address": "Apply online or at UTA customer service locations",
      "description": "Reduced fare program for qualifying riders (seniors, youth, disability, income-qualified).",
      "services": [
        "$1.00 one-way fares for qualifying seniors, youth, disabled, low-income"
      ],
      "favorite": false,
      "lastModified": "2026-02-23T21:52:03.044Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "utah-community-action",
      "name": "Utah Community Action",
      "categories": [
        "employment",
        "food",
        "housing"
      ],
      "website": "https://utahca.org/",
      "phone": "801-359-2444",
      "address": "Utah (multiple locations)",
      "description": "Programs including homelessness prevention and workforce supports.",
      "services": [
        "emergency rental assistance",
        "eviction mediation ",
        "criminal record expungement",
        "utility assistance",
        "home weatherization",
        "nutrition education",
        "Head Start preschool",
        "Workforce Development (Offering classes, certifications, and services at no cost, the Workforce Development program assists in obtaining employment, increasing wage-earning potential, and improving resume and interviewing skills.)"
      ],
      "favorite": false,
      "lastModified": "2026-02-23T22:04:24.544Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "utah-crisis-line-huntsman-mental-health-institute",
      "name": "Utah Crisis Line (Huntsman Mental Health Institute)",
      "categories": [
        "mental"
      ],
      "website": "https://healthcare.utah.edu/hmhi/programs/crisis-diversion",
      "phone": "801-587-3000",
      "address": "Utah (24/7 crisis line)",
      "description": "24/7 crisis support and diversion resources.",
      "services": [],
      "favorite": false,
      "lastModified": "2026-02-13T18:21:23Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "utah-department-of-workforce-services-provo-employment-cente",
      "name": "Utah Department of Workforce Services - Provo Employment Center",
      "categories": [
        "employment"
      ],
      "website": "https://jobs.utah.gov/",
      "phone": "801-342-2600",
      "address": "1550 N 200 W, Provo, UT 84604",
      "description": "Job search help, employment counseling, and related workforce services.",
      "services": [
        "Employment--help with resume, workshops, paying for education or training, apprenticeships",
        "Veteran and Military employment services--education, training, career path, transition",
        "Refugee resettlement, employment, resources",
        "Disabled services, blind, deaf, eligility, vocational rehabilititation"
      ],
      "favorite": false,
      "lastModified": "2026-02-23T22:13:10.625Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "utah-dhhs-opidemic-free-naloxone",
      "name": "Utah DHHS Opidemic - Free Naloxone",
      "categories": [
        "substance"
      ],
      "website": "https://opidemic.utah.gov/naloxone/free-naloxone/",
      "phone": "",
      "address": "Utah (statewide)",
      "description": "State resource page for free naloxone locations and information.",
      "services": [],
      "favorite": false,
      "lastModified": "2026-02-13T18:21:23Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "utah-naloxone",
      "name": "Utah Naloxone",
      "categories": [
        "substance"
      ],
      "website": "https://www.utahnaloxone.org/",
      "phone": "",
      "address": "Utah (statewide naloxone education/access)",
      "description": "Naloxone awareness, training, and access resources.",
      "services": [],
      "favorite": false,
      "lastModified": "2026-02-13T18:21:23Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "utah-transit-authority-uta-contact",
      "name": "Utah Transit Authority (UTA) - Contact",
      "categories": [
        "transportation"
      ],
      "website": "https://www.rideuta.com/",
      "phone": "801-743-3882",
      "address": "Utah (fixed-route transit statewide)",
      "description": "Public transit information and customer service for UTA services.",
      "services": [],
      "favorite": false,
      "lastModified": "2026-02-13T18:21:23Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "volunteers-of-america-utah",
      "name": "Volunteers of America, Utah",
      "categories": [
        "health",
        "housing",
        "mental"
      ],
      "website": "https://www.voaut.org/",
      "phone": "801-363-9414, youth resource center: 801-364-0744, ext 707",
      "address": "1875 S Redwood Rd., Salt Lake CIty, youth resource center at 888 S 400 W, Salt Lake City",
      "description": "Homeless resources\nDrop-in resource center and emergency shelter for youth ages 15–22.",
      "services": [
        "homeless support: shelters, meals, basic needs, education, employment, legal aid, housing, physical and mental health care",
        "addiction detox",
        "Youth Resource Center for ages 15-22 who are homeless or at risk of homelessness; wide range of help: shelter, meals, showers, laundry, dental, medical"
      ],
      "favorite": false,
      "lastModified": "2026-02-23T22:34:41.377Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "wasatch-behavioral-health-utah-county",
      "name": "Wasatch Behavioral Health (Utah County)",
      "categories": [
        "health",
        "housing",
        "mental",
        "substance"
      ],
      "website": "https://www.wasatch.org/",
      "phone": "801-373-4760",
      "address": "750 N Freedom Blvd, Provo, UT 84601",
      "description": "Community mental health authority for Utah County.",
      "services": [
        "Outpatient mental health",
        "psychological assessment",
        "medical services",
        "crisis residential support (stay for up to a week)",
        "crisis residential service for children and youth 10-17 (runaways, runaway risks, serious parent-child conflicts.)"
      ],
      "favorite": false,
      "lastModified": "2026-02-23T22:24:37.571Z",
      "verifiedDate": "",
      "verifiedBy": "",
      "evaluation": {
        "servesJusticeInvolved": null,
        "requiresID": null,
        "appointmentRequired": null,
        "typicalWait": "",
        "transportationBarrier": "",
        "dignityRating": null,
        "reliabilityRating": null,
        "notes": "",
        "lastEvaluatedDate": "",
        "evaluatedBy": ""
      },
      "displayOrder": null
    },
    {
      "id": "boulders",
      "name": "The Boulders",
      "categories": [
        "housing",
        "Seniors"
      ],
      "services": [
        "The Boulders Apartments offers one, two and three bedroom apartments at an affordable price, with picturesque views of the Utah mountains. Enjoy plenty of on-site outdoor amenities including the pool, basketball court and spacious picnic area. ",
        "We are also located close to shopping, dining and entertainment near downtown Provo. "
      ],
      "lastModified": "2026-02-19T18:42:02.807Z",
      "phone": "(385) 230-6692",
      "website": "boulders-apts.com",
      "address": "750 S 650 W, Provo",
      "description": ""
    },
    {
      "id": "BioLife",
      "name": "BioLife Plasma",
      "categories": [
        "employment"
      ],
      "services": [
        "Plasma donation center"
      ],
      "lastModified": "2026-02-23T22:17:31.912Z",
      "phone": "385-881-0353",
      "website": "biolifeplasma.com/locations/utah/orem",
      "address": "168 E University Parkway, Orem",
      "description": "Requires permanent local address, $80? for the first donation"
    },
    {
      "id": "people_ready",
      "name": "People Ready",
      "categories": [
        "employment"
      ],
      "services": [
        "Gig work through JobStack app."
      ],
      "lastModified": "2026-02-23T22:19:58.793Z",
      "phone": "801.561.0881",
      "website": "https://www.peopleready.com/location/provo-ut-1201/",
      "address": "175 S. Freedom Blvd. Provo ",
      "description": "PeopleReady supports a wide range of industries, including construction, manufacturing and logistics, retail and hospitality. Pays daily."
    },
    {
      "id": "grifols_plasma",
      "name": "Talecris Plasma",
      "phone": "801-377-1243",
      "website": "grifols.com",
      "address": "651 Columbia Lane, Provo",
      "hours": "",
      "description": "Requires proof of current address (or border crossing card)",
      "categories": [
        "employment"
      ],
      "services": [
        "Plasma donation center"
      ],
      "verifiedDate": "",
      "verifiedBy": "",
      "displayOrder": null,
      "evaluation": {},
      "favorite": false,
      "lastModified": "2026-02-23T22:16:45.356Z"
    },
    {
      "id": "baconwork",
      "name": "Bacon Work",
      "phone": "",
      "website": "baconwork.com",
      "address": "",
      "hours": "",
      "description": "Temporary work--warehouse, events, catering, general labor",
      "categories": [
        "employment"
      ],
      "services": [
        "an iPhone or Android app (search for bacon work) — Warehouse, events, catering, general labor"
      ],
      "verifiedDate": "",
      "verifiedBy": "",
      "displayOrder": null,
      "evaluation": {},
      "favorite": false,
      "lastModified": "2026-02-23T22:15:11.632Z"
    },
    {
      "id": "bingham_clinic",
      "name": "Bingham Family Clinic",
      "phone": "801-854-5168",
      "website": "binghamfamilycllinic.org",
      "address": "987 S. Geneva Road, Suite 141",
      "hours": "",
      "description": "Free Healthcare for the uninsured, household income less that 300% of poverty level, Utah County residents",
      "categories": [
        "health"
      ],
      "services": [
        "Acute Care",
        "Primary Care",
        "Specialty Care",
        "Educational Classes"
      ],
      "verifiedDate": "",
      "verifiedBy": "",
      "displayOrder": null,
      "evaluation": {},
      "favorite": false,
      "lastModified": "2026-02-22T08:44:38.037Z"
    },
    {
      "id": "driver_license-division",
      "name": "Driver License Division (ID for homeless persons)",
      "phone": "801-965-4437 for all offices",
      "website": "https://dld.utah.gov/homeless-fee-waiver/",
      "address": "1503 S 40 E, suite 250, Provo or 759 N 1370 W, Orem or 2277 W 700 S, suite 1, Springville",
      "hours": "",
      "description": "Driver License Offices for homeless ID",
      "categories": [
        "id"
      ],
      "services": [
        "homeless ID--go to Community Action Services or Food & Care Coalition to get a verification of homelessness (waives fee), you have to make an appointment with the Driver License Division Office, then apply in person."
      ],
      "verifiedDate": "",
      "verifiedBy": "",
      "displayOrder": null,
      "evaluation": {},
      "favorite": false,
      "lastModified": "2026-02-23T23:12:43.138Z"
    }
  ]
}
</script>

<script>

function nowISO(){ return new Date().toISOString(); }
function escapeHTML(str){ return (str||"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[m])); }

function normalizeResourceServices(r){
  if(Array.isArray(r.services)){
    r.servicesText = r.services.join("\n");
    delete r.services;
    return true;
  }
  if(!r.servicesText) r.servicesText = "";
  return false;
}

function normalizeDataServicesShape(data){
  if(!data.resources) return;
  data.resources.forEach(normalizeResourceServices);
}

function renderServicesHTML(text){
  return text.split("\n").map(line=>{
    if(line.trim().startsWith("*")){
      return `<li>${escapeHTML(line.replace(/^\*\s?/,""))}</li>`;
    }
    return `<div>${escapeHTML(line)}</div>`;
  }).join("");
}

/* ---------- Load Data ---------- */

const seed = JSON.parse(document.getElementById("seed-data").textContent);
let data = JSON.parse(localStorage.getItem("tsoData") || "null");

if(!data){
  data = seed;
  localStorage.setItem("tsoData", JSON.stringify(data));
}

normalizeDataServicesShape(data);

let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
let view = "categories";
let currentCategory = null;
let adminTab = "categories";

/* ---------- Header ---------- */

tabCategories.onclick = ()=>{ view="categories"; render(); };
tabFavorites.onclick = ()=>{ view="favorites"; render(); };
tabAdmin.onclick = ()=>{ view="admin"; render(); };

/* ---------- Resource Card ---------- */

function buildResourceCard(res,{expanded=false,showDescription=false,showStar=true}={}){
  normalizeResourceServices(res);

  const card=document.createElement("div");
  card.className="resource-card";

  if(showStar){
    const star=document.createElement("div");
    star.className="star"+(favorites.includes(res.id)?" fav":"");
    star.textContent="★";
    star.onclick=e=>{e.stopPropagation(); toggleFav(res.id);};
    card.appendChild(star);
  }

  const main=document.createElement("div");
  main.className="resource-main";
  main.innerHTML=`<strong>${res.name}</strong>`;
  if(showDescription && res.description) main.innerHTML+=`<div>${escapeHTML(res.description)}</div>`;

  const details=document.createElement("div");
  details.className="resource-details "+(expanded?"expanded":"collapsed");

  let html="";
  if(res.phone) html+=`<div><strong>Phone:</strong> <a href="tel:${res.phone}">${res.phone}</a></div>`;
  if(res.address) html+=`<div><strong>Address:</strong> ${escapeHTML(res.address)}</div>`;
  if(res.website) html+=`<div><strong>Website:</strong> <a href="${res.website}" target="_blank">${res.website}</a></div>`;
  if(res.servicesText) html+=`<div><strong>Services:</strong>${renderServicesHTML(res.servicesText)}</div>`;

  details.innerHTML=html;
  main.appendChild(details);
  card.appendChild(main);
  return card;
}

/* ---------- Render ---------- */

function render(){
  tabFavorites.textContent=`Favorites (${favorites.length})`;
  appView.classList.toggle("hidden", view==="admin");
  adminView.classList.toggle("hidden", view!=="admin");

  if(view==="admin"){ renderAdmin(); return; }

  appView.innerHTML="";

  if(view==="categories"){
    const grid=document.createElement("div");
    grid.className="grid";

    data.categories.slice().sort((a,b)=>(a.displayOrder??999)-(b.displayOrder??999)).forEach(cat=>{
      const card=document.createElement("div");
      card.className="category-card";
      card.innerHTML=`<strong>${cat.label}</strong>`;
      card.onclick=()=>{ currentCategory=cat.id; view="category"; render(); };
      grid.appendChild(card);
    });

    appView.appendChild(grid);
  }

  if(view==="category"){
    const back=document.createElement("button");
    back.textContent="← Back";
    back.onclick=()=>{ view="categories"; render(); };
    appView.appendChild(back);

    data.resources.filter(r=>r.categories?.includes(currentCategory)).forEach(res=>{
      let expanded=false;
      const card=buildResourceCard(res,{showDescription:true});
      card.onclick=()=>{
        expanded=!expanded;
        const d=card.querySelector(".resource-details");
        d.classList.toggle("collapsed",!expanded);
        d.classList.toggle("expanded",expanded);
      };
      appView.appendChild(card);
    });
  }

  if(view==="favorites"){
    const favs=data.resources.filter(r=>favorites.includes(r.id));
    if(!favs.length){ appView.innerHTML="<p>No favorites selected.</p>"; return; }

    const btn=document.createElement("button");
    btn.textContent="Print Preview";
    btn.className="button primary";
    btn.onclick=printFavorites;
    appView.appendChild(btn);

    favs.forEach(res=> appView.appendChild(buildResourceCard(res,{expanded:true})));
  }
}

/* ---------- Favorites ---------- */

function toggleFav(id){
  const set=new Set(favorites);
  set.has(id)?set.delete(id):set.add(id);
  favorites=[...set];
  localStorage.setItem("favorites",JSON.stringify(favorites));
  render();
}

/* ---------- Print ---------- */

function printFavorites(){
  const favs=data.resources.filter(r=>favorites.includes(r.id));
  printContent.innerHTML="<h2>Suggested Resources</h2>";
  favs.forEach(res=>{
    const card=buildResourceCard(res,{expanded:true,showStar:false});
    printContent.appendChild(card);
  });
  printModal.classList.remove("hidden");
}

function closePrintPreview(){ printModal.classList.add("hidden"); }
function doPrint(){ window.print(); }

/* ---------- Admin ---------- */

function renderAdmin(){

  const container = document.getElementById("adminView");

  container.innerHTML = `
    <div style="margin-bottom:20px;">
      <button class="button primary" onclick="exportJSON()">
        Export resources
      </button>
      <input type="file" id="importFile" accept=".json"
        style="display:none"
        onchange="importJSON(event)">

      <button class="button"
        onclick="document.getElementById('importFile').click()">
        Import resources
      </button>
      <div style="margin-top:10px;">
        Last Modified: ${data.lastModified || "(none)"}
      </div>
    </div>

    <div>
      <button class="button ${adminTab==='categories'?'primary':''}"
        onclick="adminTab='categories';renderAdmin()">
        Categories
      </button>

      <button class="button ${adminTab==='resources'?'primary':''}"
        onclick="adminTab='resources';renderAdmin()">
        Resources
      </button>
    </div><br>
  `;

  if(adminTab === "categories"){
    renderAdminCategories(container);
  }

  if(adminTab === "resources"){
    renderAdminResources(container);
  }
}

/* =========================
   Persistence + Import/Export
========================= */

function persist(){
  data.lastModified = nowISO();
  localStorage.setItem("tsoData", JSON.stringify(data));
}

function exportJSON(){
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "tso-resources.json";
  document.body.appendChild(a);
  a.click();
  a.remove();

  URL.revokeObjectURL(url);
}

function importJSON(event){
  const file = event.target.files && event.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    try{
      const imported = JSON.parse(reader.result);

      // Normalize legacy services[] -> servicesText
      if(imported && imported.resources){
        imported.resources.forEach(r => normalizeResourceServices(r));
      }

      data = imported;
      persist();
      alert("Import complete.");
      render();
    }catch(e){
      alert("Import failed: " + e.message);
    }
  };
  reader.readAsText(file);

  // allow re-import of same filename
  event.target.value = "";
}

/* =========================
   Admin UI
========================= */

function renderAdmin(){

  const container = document.getElementById("adminView");

  container.innerHTML = `
    <div style="margin-bottom:20px;">
      <button class="button primary" onclick="exportJSON()">Export resources</button>

      <input type="file" id="importFile" accept=".json"
        style="display:none"
        onchange="importJSON(event)">

      <button class="button" onclick="document.getElementById('importFile').click()">Import resources</button>

      <div style="margin-top:10px;">
        Last Modified: ${data.lastModified || "(none)"}
      </div>
    </div>

    <div>
      <button class="button ${adminTab==='categories'?'primary':''}"
        onclick="adminTab='categories';renderAdmin()">
        Categories
      </button>

      <button class="button ${adminTab==='resources'?'primary':''}"
        onclick="adminTab='resources';renderAdmin()">
        Resources
      </button>
    </div>
    <br>
  `;

  if(adminTab === "categories") renderAdminCategories(container);
  if(adminTab === "resources") renderAdminResources(container);
}

/* ---------- Admin: Categories ---------- */

function renderAdminCategories(container){

  container.innerHTML += `
    <div class="admin-panel">
      <div class="admin-box">
        <h3>Categories</h3>
        <select id="catSelect"></select>
        <div style="margin-top:8px;">
          <button class="button" onclick="newCategory()">New</button>
          <button class="button danger" onclick="deleteCategory()">Delete</button>
        </div>
      </div>
      <div class="admin-box" id="catEditor"></div>
    </div>
  `;

  const sel = document.getElementById("catSelect");

  // sort for display, but keep option value = real index
  const pairs = data.categories.map((c,i)=>({c,i}));
  pairs.sort((a,b)=>(a.c.displayOrder ?? 999)-(b.c.displayOrder ?? 999));

  pairs.forEach(({c,i})=>{
    const opt = document.createElement("option");
    opt.value = String(i);
    opt.textContent = c.label;
    sel.appendChild(opt);
  });

  sel.onchange = () => editCategory(parseInt(sel.value,10));

  if(sel.options.length){
    sel.value = sel.options[0].value;
    editCategory(parseInt(sel.value,10));
  }
}

function newCategory(){
  const newIndex = data.categories.length;

  data.categories.push({
    id: "new-category",
    label: "New Category",
    icon: "",
    active: true,
    lastModified: nowISO(),
    displayOrder: null
  });

  persist();
  adminTab = "categories";
  renderAdmin();

  const sel = document.getElementById("catSelect");
  if(sel){
    sel.value = String(newIndex);
    editCategory(newIndex);
  }
}

function deleteCategory(){
  const sel = document.getElementById("catSelect");
  if(!sel || !sel.value) return;

  const idx = parseInt(sel.value,10);
  const cat = data.categories[idx];
  if(!cat) return;

  if(!confirm(`Delete category "${cat.label}"?`)) return;

  // remove category from resources too
  data.resources.forEach(r=>{
    if(Array.isArray(r.categories)){
      r.categories = r.categories.filter(id => id !== cat.id);
    }
  });

  data.categories.splice(idx,1);
  persist();
  renderAdmin();
}

function editCategory(idx){
  const cat = data.categories[idx];
  const editor = document.getElementById("catEditor");
  if(!cat || !editor) return;

  editor.innerHTML = `
    <h3>Edit Category</h3>

    <label>ID<br>
      <input id="cat_id" value="${escapeHTML(cat.id || "")}">
    </label><br><br>

    <label>Label<br>
      <input id="cat_label" value="${escapeHTML(cat.label || "")}">
    </label><br><br>

    <label>Icon<br>
      <input id="cat_icon" value="${escapeHTML(cat.icon || "")}">
    </label><br><br>

    <label>Display order (optional)<br>
      <input id="cat_order" type="number" value="${cat.displayOrder ?? ""}">
    </label><br><br>

    <label>
      <input id="cat_active" type="checkbox" ${cat.active ? "checked" : ""}>
      Active
    </label><br><br>

    <button class="button primary" onclick="saveCategory(${idx})">Save</button>
  `;
}

function saveCategory(idx){
  const cat = data.categories[idx];
  if(!cat) return;

  cat.id = document.getElementById("cat_id").value.trim() || cat.id;
  cat.label = document.getElementById("cat_label").value.trim() || cat.label;
  cat.icon = document.getElementById("cat_icon").value.trim();
  const ord = document.getElementById("cat_order").value;
  cat.displayOrder = ord === "" ? null : Number(ord);
  cat.active = document.getElementById("cat_active").checked;
  cat.lastModified = nowISO();

  persist();
  renderAdmin();
}

/* ---------- Admin: Resources ---------- */

function renderAdminResources(container){

  container.innerHTML += `
    <div class="admin-panel">
      <div class="admin-box">
        <h3>Resources</h3>
        <select id="resSelect"></select>
        <div style="margin-top:8px;">
          <button class="button" onclick="newResource()">New</button>
          <button class="button danger" onclick="deleteResource()">Delete</button>
        </div>
      </div>
      <div class="admin-box" id="resEditor"></div>
    </div>
  `;

  const sel = document.getElementById("resSelect");

  const pairs = data.resources.map((r,i)=>({r,i}));
  pairs.sort((a,b)=>(a.r.displayOrder ?? 999)-(b.r.displayOrder ?? 999) || a.r.name.localeCompare(b.r.name));

  pairs.forEach(({r,i})=>{
    const opt = document.createElement("option");
    opt.value = String(i);
    opt.textContent = r.name;
    sel.appendChild(opt);
  });

  sel.onchange = ()=> editResource(parseInt(sel.value,10));

  if(sel.options.length){
    sel.value = sel.options[0].value;
    editResource(parseInt(sel.value,10));
  }
}

function newResource(){
  const newIndex = data.resources.length;

  data.resources.push({
    id: "new-resource",
    name: "New Resource",
    categories: [],
    phone: "",
    address: "",
    website: "",
    hours: "",
    description: "",
    servicesText: "",
    verifiedDate: "",
    verifiedBy: "",
    displayOrder: null,
    favorite: false,
    evaluation: {},
    lastModified: nowISO()
  });

  persist();
  adminTab = "resources";
  renderAdmin();

  const sel = document.getElementById("resSelect");
  if(sel){
    sel.value = String(newIndex);
    editResource(newIndex);
  }
}

function deleteResource(){
  const sel = document.getElementById("resSelect");
  if(!sel || !sel.value) return;

  const idx = parseInt(sel.value,10);
  const res = data.resources[idx];
  if(!res) return;

  if(!confirm(`Delete resource "${res.name}"?`)) return;

  data.resources.splice(idx,1);
  persist();
  renderAdmin();
}

function editResource(idx){
  const res = data.resources[idx];
  const editor = document.getElementById("resEditor");
  if(!res || !editor) return;

  normalizeResourceServices(res);

  const catChecks = data.categories
    .slice()
    .sort((a,b)=>(a.displayOrder ?? 999)-(b.displayOrder ?? 999))
    .map(c=>{
      const checked = (res.categories||[]).includes(c.id) ? "checked" : "";
      return `<label style="display:block;">
        <input type="checkbox" class="resCat" value="${escapeHTML(c.id)}" ${checked}>
        ${escapeHTML(c.label)}
      </label>`;
    }).join("");

  editor.innerHTML = `
    <h3>Edit Resource</h3>

    <label>ID<br>
      <input id="res_id" value="${escapeHTML(res.id || "")}">
    </label><br><br>

    <label>Name<br>
      <input id="res_name" value="${escapeHTML(res.name || "")}">
    </label><br><br>

    <label>Display order (optional)<br>
      <input id="res_order" type="number" value="${res.displayOrder ?? ""}">
    </label><br><br>

    <label>Phone<br>
      <input id="res_phone" value="${escapeHTML(res.phone || "")}">
    </label><br><br>

    <label>Address<br>
      <input id="res_address" value="${escapeHTML(res.address || "")}">
    </label><br><br>

    <label>Website<br>
      <input id="res_website" type="url" value="${escapeHTML(res.website || "")}">
    </label><br><br>

    <label>Hours<br>
      <input id="res_hours" value="${escapeHTML(res.hours || "")}">
    </label><br><br>

    <label>Description<br>
      <textarea id="res_description" class="big">${escapeHTML(res.description || "")}</textarea>
    </label><br><br>

    <label>Services (free-form; lines starting with * become bullets)<br>
      <textarea id="res_services" class="big">${escapeHTML(res.servicesText || "")}</textarea>
    </label><br><br>

    <div>
      <strong>Categories</strong><br>
      ${catChecks}
    </div><br>

    <button class="button primary" onclick="saveResource(${idx})">Save</button>
  `;
}

function saveResource(idx){
  const res = data.resources[idx];
  if(!res) return;

  res.id = document.getElementById("res_id").value.trim() || res.id;
  res.name = document.getElementById("res_name").value.trim() || res.name;

  const ord = document.getElementById("res_order").value;
  res.displayOrder = ord === "" ? null : Number(ord);

  res.phone = document.getElementById("res_phone").value.trim();
  res.address = document.getElementById("res_address").value.trim();
  res.website = document.getElementById("res_website").value.trim();
  res.hours = document.getElementById("res_hours").value.trim();
  res.description = document.getElementById("res_description").value;
  res.servicesText = document.getElementById("res_services").value;

  res.categories = Array.from(document.querySelectorAll(".resCat"))
    .filter(cb=>cb.checked)
    .map(cb=>cb.value);

  res.lastModified = nowISO();

  persist();
  renderAdmin();
}

/* ---------- Hidden Reset Hotkey ---------- */
/*
  Ctrl + Alt + Shift + R  => wipe localStorage keys used by this app and reload.
  Safety: requires typing RESET
*/
window.addEventListener("keydown", (e) => {
  const isResetCombo =
    e.ctrlKey && e.altKey && e.shiftKey &&
    (e.key === "R" || e.key === "r");

  if (!isResetCombo) return;

  // Prevent browser/OS shortcuts from also firing
  e.preventDefault();
  e.stopPropagation();

  const confirmText = prompt(
    "Type RESET to clear local data (tsoData + favorites) and reload:"
  );

  if (confirmText !== "RESET") return;

  localStorage.removeItem("tsoData");
  localStorage.removeItem("favorites");

  location.reload();
}, true);

/* ---------- Start ---------- */

render();

</script>
</body>
</html>
